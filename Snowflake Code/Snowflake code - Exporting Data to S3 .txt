-- Copy scr_admission table
COPY INTO @my_s3_stage/scr_admission/
FROM scr_admission
FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='"' COMPRESSION=GZIP)
SINGLE = TRUE
OVERWRITE = TRUE;

-- Copy scr_bed_inventory table
COPY INTO @my_s3_stage/scr_bed_inventory/
FROM scr_bed_inventory
FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='"' COMPRESSION=GZIP)
SINGLE = TRUE
OVERWRITE = TRUE;

-- Copy scr_discharges table
COPY INTO @my_s3_stage/scr_discharges/
FROM scr_discharges
FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='"' COMPRESSION=GZIP)
SINGLE = TRUE
OVERWRITE = TRUE;

-- Copy scr_transfer table
COPY INTO @my_s3_stage/scr_transfer/
FROM scr_transfer
FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='"' COMPRESSION=GZIP)
SINGLE = TRUE
OVERWRITE = TRUE;



-- ⬆️ EXPORT PROCESSED DIMENSIONS AND FACT TABLES TO S3 (USEFUL FOR BACKUP OR SHARING)
CREATE OR REPLACE STAGE hospital_s3_stage
  URL = 's3://your-bucket-name'
  STORAGE_INTEGRATION = your_snowflake_integration;

-- EXPORT EACH TRANSFORMED TABLE TO S3
COPY INTO @hospital_s3_stage/dim_patient/
FROM HOSPITAL.HOSPITAL_DATA.DIM_PATIENT
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' OVERWRITE = TRUE SINGLE = TRUE);

COPY INTO @hospital_s3_stage/dim_department/
FROM HOSPITAL.HOSPITAL_DATA.DIM_DEPARTMENT
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' OVERWRITE = TRUE SINGLE = TRUE);

COPY INTO @hospital_s3_stage/dim_bed/
FROM HOSPITAL.HOSPITAL_DATA.DIM_BED
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' OVERWRITE = TRUE SINGLE = TRUE);

COPY INTO @hospital_s3_stage/fact_admission_events/
FROM HOSPITAL.HOSPITAL_DATA.FACT_ADMISSION_EVENTS
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' OVERWRITE = TRUE SINGLE = TRUE);

COPY INTO @hospital_s3_stage/fact_transfer_events/
FROM HOSPITAL.HOSPITAL_DATA.FACT_TRANSFER_EVENTS
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' OVERWRITE = TRUE SINGLE = TRUE);
